<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Manager DApp</title>

    <!-- Main stylesheet -->
    <link rel="stylesheet" href="style.css" />

    <!-- Web3.js v4 (CSP safe) -->
    <script src="https://cdn.jsdelivr.net/npm/web3@4.2.2/dist/web3.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>âœ… Task Manager DApp</h1>
            <p>Blockchain-Based Task Management System</p>
            <div id="accountInfo">
                <p><strong>Account:</strong> <span id="account">Not connected</span></p>
                <p><strong>Contract:</strong> <span id="contractAddress">Not deployed</span></p>
                <button id="connectButton" class="btn btn-primary" style="max-width: 300px; margin: 20px auto 0;">
                    ğŸ¦Š Connect MetaMask
                </button>
                <p id="connectionStatus" style="margin-top: 10px; font-size: 0.9em;"></p>
            </div>
        </header>

        <div class="main-content">
            <!-- Add Task Section -->
            <section class="card">
                <h2>â• Add New Task</h2>
                <form id="addTaskForm">
                    <div class="form-group">
                        <label for="taskText">Task Description:</label>
                        <textarea id="taskText" rows="3" placeholder="Enter your task..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Task</button>
                </form>
            </section>

            <!-- View Task Section -->
            <section class="card">
                <h2>ğŸ” View Task Details</h2>
                <form id="viewTaskForm">
                    <div class="form-group">
                        <label for="viewTaskId">Task ID:</label>
                        <input type="number" id="viewTaskId" min="0" required />
                    </div>
                    <button type="submit" class="btn btn-secondary">View Task</button>
                </form>
                <div id="taskDetails" class="task-details"></div>
            </section>

            <!-- Complete Task Section -->
            <section class="card">
                <h2>âœ”ï¸ Mark Task as Complete</h2>
                <form id="completeTaskForm">
                    <div class="form-group">
                        <label for="completeTaskId">Task ID:</label>
                        <input type="number" id="completeTaskId" min="0" required />
                    </div>
                    <button type="submit" class="btn btn-success">Complete Task</button>
                </form>
            </section>

            <!-- Statistics Section -->
            <section class="card stats-card">
                <h2>ğŸ“Š Statistics</h2>
                <div class="stats">
                    <div class="stat-item">
                        <span class="stat-label">Total Tasks:</span>
                        <span class="stat-value" id="taskCount">0</span>
                    </div>
                </div>
                <button onclick="loadTaskCount()" class="btn btn-secondary">Refresh Count</button>
            </section>

            <!-- All Tasks List -->
            <section class="card full-width">
                <h2>ğŸ“‹ All Tasks</h2>
                <div class="filter-buttons">
                    <button onclick="loadAllTasks('all')" class="btn btn-filter">All Tasks</button>
                    <button onclick="loadAllTasks('pending')" class="btn btn-filter">Pending</button>
                    <button onclick="loadAllTasks('completed')" class="btn btn-filter">Completed</button>
                </div>
                <div id="tasksList" class="tasks-list"></div>
            </section>
        </div>

        <div id="statusMessage" class="status-message"></div>
    </div>

    <!-- App Logic -->
    <script src="script.js"></script>
</body>
</html>